<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>VTO</title>
    <script src="https://dsf-cdn.loreal.io/dropper.js" type="application/javascript" defer=""></script>
    <script>
        function vtoAdd2Cart(payload) {
            location.href = "vto_add2cart://" + encodeURIComponent(JSON.stringify(payload));
        }
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            console.log("[VTO] DOMContentLoaded");
            const urlParams = new URLSearchParams(window.location.search);
            const upc = urlParams.get("upc");
            console.log("[VTO] UPC desde URL:", upc);

            const dsfApp = document.querySelector('dsf-app');
            if (dsfApp) {
                if (upc) {
                    dsfApp.setAttribute('vto_upc_list', upc);
                    dsfApp.setAttribute('vto_selected_upc', upc);
                    console.log("[VTO] Atributos asignados:", {
                        vto_upc_list: dsfApp.getAttribute('vto_upc_list'),
                        vto_selected_upc: dsfApp.getAttribute('vto_selected_upc')
                    });
                } else {
                    console.warn("[VTO] No se encontr칩 el par치metro 'upc' en la URL.");
                }
            } else {
                console.error("[VTO] No se encontr칩 el elemento <dsf-app> en el DOM.");
            }

            const tryAttachCloseHandler = () => {
                const closeBtn = document
                    .querySelector('dsf-app')?.shadowRoot
                    ?.querySelector('button.close-button');

                if (closeBtn && !closeBtn.hasAttribute('data-close-handler')) {
                    closeBtn.setAttribute('data-close-handler', 'attached');
                    closeBtn.addEventListener('click', () => {
                        location.href = 'vto_close://true';
                    });
                    console.log("[VTO] Handler de cierre conectado al bot칩n.");
                } else {
                    setTimeout(tryAttachCloseHandler, 300);
                }
            };
            tryAttachCloseHandler();
        });
    </script>

    <style>
        html, body { margin: 0; padding: 0; height: 100%; overflow: hidden; }
    </style>
</head>
<body>
<dsf-app
        type="std"
        tenant="modiface"
        application="vto"
        touchpoint="web"
        customer="farmashop"
        country="ury-es"
        environment="production"
        vto_type="sp"
        vto_category="make-up"
        vto_upc_list=""
        vto_selected_upc=""
        style="width:100vw;height:100vh;display:block"
/>
</body>
</html>
